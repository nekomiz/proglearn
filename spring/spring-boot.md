# Spring Boot
- [Что такое Spring Boot?](#что-такое-spring-boot)
- [В чем разница между Spring Framework  и Spring Boot?](#в-чем-разница-между-spring-framework-и-spring-boot)
- [Что такое Spring Initializr?](#что-такое-spring-initializr)
- [Какие стартеры Spring Boot существуют?](#какие-стартеры-spring-boot-существуют)
- [Как отключить определенную автоконфигурацию?](#как-отключить-определенную-автоконфигурацию)
- [Как зарегистрировать кастомную автоконфигурацию?](#как-зарегистрировать-кастомную-автоконфигурацию)
- [Как развернуть веб-приложения Spring Boot в виде Jar- и War-файлов?](#как-развернуть-веб-приложения-spring-boot-в-виде-jar--и-war-файлов)
- [Каковы возможные источники внешней конфигурации?](#каковы-возможные-источники-внешней-конфигурации)
- [Что означает, что Spring Boot поддерживает расслабленное связывание?](#что-означает-что-spring-boot-поддерживает-расслабленное-связывание)
- [Для чего используется Spring Boot DevTools?](#для-чего-используется-spring-boot-devtools)
- [Как писать интеграционные тесты?](#как-писать-интеграционные-тесты)
- [Для чего используется Spring Boot Actuator?](#для-чего-используется-spring-boot-actuator)
- [Какие базовые аннотации предлагает Spring Boot?](#какие-базовые-аннотации-предлагает-spring-boot)
- [Зачем нам нужны Spring профили?](#зачем-нам-нужны-spring-профили)
- [Как происходит автоконфигурация](#как-происходит-автоконфигурация)
- [Делаем свой Starter-пакет](#делаем-свой-starter-пакет)
- [Источники](#источники)



## Что такое Spring Boot?
> это фреймворк для разработки Java-приложений, который упрощает создание микросервисов и сделан на Spring Framework. Он предоставляет множество функций и инструментов, которые помогают разработчикам быстро создавать и развертывать приложения. Spring Boot автоматически настраивает множество компонентов и библиотек, что позволяет сосредоточиться на разработке бизнес-логики приложения.


Некоторые особенности Spring Boot включают в себя:

__Автоматическая конфигурация__: Spring Boot автоматически настраивает множество компонентов и библиотек, основываясь на классах и зависимостях, которые вы используете в своем проекте.

__Встроенный сервер приложений__: Spring Boot поставляется с встроенным сервером приложений, таким как Tomcat или Jetty, что позволяет вам запускать приложение без необходимости настройки отдельного сервера.

__Управление зависимостями__: Spring Boot упрощает управление зависимостями, позволяя вам указывать зависимости в файле конфигурации и автоматически загружать их при сборке проекта.

__Актуаторы__: Spring Boot предоставляет актуаторы, которые позволяют мониторить и управлять вашим приложением во время его выполнения. Например, вы можете получить информацию о состоянии приложения, проверить журналы или перезагрузить приложение без его остановки.

__Интеграция с другими технологиями__: Spring Boot интегрируется с другими популярными технологиями, такими как Spring Data, Spring Security, Spring Cloud и многими другими, что позволяет вам создавать сложные и масштабируемые приложения.

__Стартеры__ - набор дескрипторов зависимостей для включения соответствующих зависимостей на начальном этапе.

__Безопасность__ - для обеспечения аутентификации и авторизации

__Логирование__ - запись событий в определенные моменты выполнения программы

## В чем разница между Spring Framework  и Spring Boot?
Spring Framework предоставляет множество функций, которые упрощают разработку веб-приложений. К ним относятся инъекция зависимостей, связывание данных, аспектно-ориентированное программирование, доступ к данным и многое другое.

С годами Spring становился все более сложным, и количество конфигураций, которые требует такое приложение, может пугать. Именно здесь на помощь приходит Spring Boot - он делает настройку Spring-приложения простым делом.

По сути, в то время как Spring не имеет собственного мнения, Spring Boot имеет собственное мнение о платформе и библиотеках, позволяя нам быстро приступить к работе.

Вот два наиболее важных преимущества Spring Boot:

- Автоконфигурирование приложений на основе артефактов, которые он находит в classpath
- Предоставление нефункциональных возможностей, характерных для производственных приложений, таких как безопасность или проверка работоспособности.

## Что такое Spring Initializr?
__Spring Initializr__ - это удобный способ создания проекта Spring Boot.

Мы можем зайти на сайт Spring Initializr, выбрать инструмент управления зависимостями (Maven или Gradle), язык (Java, Kotlin или Groovy), схему упаковки (Jar или War), версию и зависимости, и загрузить проект.

Это создает для нас скелетный проект и экономит время на настройку, чтобы мы могли сосредоточиться на добавлении бизнес-логики.

Даже когда мы используем мастер создания нового проекта нашей IDE (например, STS или Eclipse с плагином STS) для создания проекта Spring Boot, он использует Spring Initializr под капотом.

## Какие стартеры Spring Boot существуют?
Самые распространенные:

- __spring-boot-starter__: основной стартер, включающий поддержку автоконфигурации, ведение логов и YAML
- __spring-boot-starter-aop__: для аспектно-ориентированного программирования с Spring AOP и AspectJ
- __spring-boot-starter-data-jpa__: для использования Spring Data JPA с Hibernate
- __spring-boot-starter-security__: для использования Spring Security
- __spring-boot-starter-test__: для тестирования приложений Spring Boot
- __spring-boot-starter-web__: для создания веб-приложений, включая RESTful, с использованием Spring MVC

## Как отключить определенную автоконфигурацию?
Если мы хотим отключить определенную автоконфигурацию, мы можем указать ее с помощью атрибута exclude аннотации @EnableAutoConfiguration.

Например, этот фрагмент кода нейтрализует DataSourceAutoConfiguration:

```java
// other annotations
@EnableAutoConfiguration(exclude = DataSourceAutoConfiguration.class)
public class MyConfiguration { }
```

Либо выключением в конфигурации.

## Как зарегистрировать кастомную автоконфигурацию?

Чтобы зарегистрировать класс автоконфигурации, мы должны иметь его полное имя, перечисленное в ключе EnableAutoConfiguration в файле META-INF/spring.factories:

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.baeldung.autoconfigure.CustomAutoConfiguration
```

Если мы собираем проект с помощью Maven, этот файл должен быть помещен в каталог resources/META-INF, который окажется в указанном месте на этапе упаковки.

## Как развернуть веб-приложения Spring Boot в виде Jar- и War-файлов?
Spring решает эту проблему, предоставляя плагин, а именно spring-boot-maven-plugin, для упаковки веб-приложения в виде исполняемого файла JAR

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
</plugin>
```

Обратите внимание, что элемент packaging в файле pom.xml должен быть установлен на jar/war, чтобы собрать JAR-файл/WAR-файл:

```xml
<packaging>jar</packaging>
```

и оставьте зависимость от контейнера в упакованном файле:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-tomcat</artifactId>
    <scope>provided</scope>
</dependency>
```

## Каковы возможные источники внешней конфигурации?
Мы можем использовать файлы свойств, YAML-файлы, переменные окружения, системные свойства и аргументы опций командной строки для указания свойств конфигурации.

Затем мы можем получить доступ к этим свойствам с помощью аннотации @Value, связанного объекта с помощью аннотации @ConfigurationProperties или абстракции Environment.


## Что означает, что Spring Boot поддерживает расслабленное связывание?
Расслабленное связывание в Spring Boot применяется для безопасного с точки зрения типов связывания свойств конфигурации.

При расслабленном связывании ключ свойства не обязательно должен точно совпадать с именем свойства. Такое свойство среды может быть записано в camelCase, kebab-case, snake_case или в верхнем регистре со словами, разделенными подчеркиваниями.

Например, если свойство в классе бобов с аннотацией @ConfigurationProperties называется myProp, оно может быть привязано к любому из этих свойств окружения: myProp, my-prop, my_prop или MY_PROP.

## Для чего используется Spring Boot DevTools?
Spring Boot Developer Tools, или DevTools, - это набор инструментов, облегчающих процесс разработки.

Чтобы включить эти функции в процесс разработки, нам нужно просто добавить зависимость в файл pom.xml:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
</dependency>
```

Модуль spring-boot-devtools автоматически отключается, если приложение работает в продакшене. Переупаковка архивов также исключает этот модуль по умолчанию. Таким образом, он не принесет никаких излишеств в наш конечный продукт.

По умолчанию DevTools применяет свойства, подходящие для среды разработки. Эти свойства отключают кэширование шаблонов, включают отладочную регистрацию для веб-группы и так далее. В результате мы получаем разумную конфигурацию на время разработки без установки каких-либо свойств.

Приложения, использующие DevTools, перезапускаются при каждом изменении файла в classpath. Это очень полезная функция при разработке, так как она позволяет быстро получить информацию об изменениях.

По умолчанию статические ресурсы, включая шаблоны представлений, не вызывают перезапуска. Вместо этого изменение ресурса вызывает обновление браузера. Обратите внимание, что это может произойти только в том случае, если в браузере установлено расширение LiveReload для взаимодействия со встроенным сервером LiveReload, который содержит DevTools.


## Как писать интеграционные тесты?
При выполнении интеграционных тестов для приложения Spring у нас должен быть ApplicationContext.

Чтобы облегчить нам жизнь, Spring Boot предоставляет специальную аннотацию для тестирования - @SpringBootTest. Эта аннотация создает ApplicationContext из конфигурационных классов, указанных в атрибуте classes.

Если атрибут classes не задан, Spring Boot ищет первичный класс конфигурации. Поиск начинается с пакета, содержащего тест, пока не будет найден класс, аннотированный @SpringBootApplication или @SpringBootConfiguration.

## Для чего используется Spring Boot Actuator?
По сути, Actuator оживляет приложения Spring Boot, позволяя использовать функции, готовые к производству. Эти функции позволяют нам контролировать и управлять приложениями, когда они работают в производстве.

Интегрировать Spring Boot Actuator в проект очень просто. Все, что нам нужно сделать, это включить стартер spring-boot-starter-actuator в файл pom.xml:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

Spring Boot Actuator может предоставлять оперативную информацию, используя конечные точки HTTP или JMX. Но большинство приложений используют HTTP, где идентификатор конечной точки и префикс /actuator формируют URL-путь.

Вот некоторые из наиболее распространенных встроенных конечных точек, которые предоставляет Actuator:
- env - отображает свойства среды
- health - показывает информацию о состоянии приложения
- httptrace - отображает информацию о трассировке HTTP
- info - отображает произвольную информацию о приложении
- metrics - показывает информацию о метриках
- loggers - показывает и изменяет конфигурацию логгеров в приложении
- mappings - отображает список всех путей @RequestMapping


## Какие базовые аннотации предлагает Spring Boot?
Основные аннотации, которые предлагает Spring Boot, находятся в его пакете org.springframework.boot.autoconfigure и его подпакетах.

Вот несколько основных из них:
- @EnableAutoConfiguration - чтобы Spring Boot искал бины автоконфигурации в своем classpath и автоматически применял их.
- @SpringBootApplication - для обозначения основного класса Boot-приложения. Эта аннотация объединяет аннотации @Configuration, @EnableAutoConfiguration и @ComponentScan с их атрибутами по умолчанию.

## Зачем нам нужны Spring профили?
При разработке приложений для предприятия мы обычно имеем дело с несколькими средами, такими как Dev, QA и Prod. Свойства конфигурации для этих сред различны.

Например, в Dev мы можем использовать встроенную базу данных H2, а в Prod - проприетарную Oracle или DB2. Даже если СУБД в разных средах одинаковая, URL-адреса, безусловно, будут разными.

Чтобы сделать это проще и чище, в Spring предусмотрены профили, которые помогают разделить конфигурацию для каждой среды. Таким образом, вместо того, чтобы поддерживать это программно, свойства можно хранить в отдельных файлах, таких как application-dev.properties и application-prod.properties. По умолчанию application.properties указывает на активный в данный момент профиль с помощью spring.profiles.active, так что правильная конфигурация подхватывается.


## Как происходит автоконфигурация
1. Отмечаем main класс аннотацией @SpringBootApplication (аннотация инкапсулирует в себе:@SpringBootConfiguration, @ComponentScan, @EnableAutoConfiguration), таким образом наличие @SpringBootApplication включает сканирование компонентов, автоконфигурацию и показывает разным компонентам Spring (например, интеграционным тестам), что это Spring Boot приложение.
```java
@SpringBootApplication
public class DemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
```

2. @EnableAutoConfiguration импортирует класс EnableAutoConfigurationImportSelector. Этот класс не объявляет бины сам, а использует так называемые фабрики.
3. Класс EnableAutoConfigurationImportSelector смотрит в файл META-INF/spring.factories и загружает оттуда список значений, которые являются именами классов (авто)конфигураций, которые Spring Boot импортирует. Т.е. аннотация @EnableAutoConfiguration просто импортирует ВСЕ (более 150) перечисленные в spring.factories конфигурации, чтобы предоставить нужные бины в контекст приложения.
4. Каждая из этих конфигураций пытается сконфигурировать различные аспекты приложения(web, JPA, AMQP и т.д.), регистрируя нужные бины. Логика при регистрации бинов управляется набором @ConditionalOn* аннотаций. Можно указать, чтобы бин создавался при наличии класса в classpath (@ConditionalOnClass), наличии существующего бина (@ConditionalOnBean), отсуствии бина (@ConditionalOnMissingBean) и т.п. Таким образом наличие конфигурации не значит, что бин будет создан, и в большинстве случаев конфигурация ничего делать и создавать не будет.
5. Созданный в итоге AnnotationConfigEmbeddedWebApplicationContext ищет в том же DI контейнере фабрику для запуска embedded servlet container.
6. Servlet container запускается, приложение готово к работе!


## Делаем свой Starter-пакет
1.  Создаем AutoConfiguration-класс, который Spring Boot находит при запуске приложения и использует для автоматического создания и конфигурирования бинов.
```java
@Configuration   //указываем, что наш класс является конфигурацией (@Configuration)
@ConditionalOnClass({SocialConfigurerAdapter.class, VKontakteConnectionFactory.class})   //означает, что бины будут создаваться при наличии в classpath SocialConfigurerAdapter и VKontakteConnectionFactory. Таким образом, без нужных для нашего стартера зависимостей бины создаваться не будут.

@ConditionalOnProperty(prefix= "ru.shadam.social-vkontakte", name = { "client-id", "client-secret"})     //означает, что бины будут создаваться только при наличии property ru.shadam.social-vkontakte.client-id и ru.shadam.social-vkontakte.client-secret.
@AutoConfigureBefore(SocialWebAutoConfiguration.class)
@AutoConfigureAfter(WebMvcAutoConfiguration.class)          //означает, что наш бин будет инициализироваться после WebMvc и до SocialWeb. Это нужно, чтобы к моменту инициализации SocialWeb наши бины уже были зарегистрированы.
public class VKontakteAutoConfiguration {
}
```

2. Расширяем SocialConfigurationAdapter, который нужен для того чтобы зарегистрировать нашу ConnectionFactory. Для этого переопределяем метод _addConnectionFactories(ConnectionFactoryConfigurer, Environment)_
3. Создание файла, позволяющего SpringBoot найти наш AutoConfiguration класс. Для этого существует специальный файл spring.factories, который нужно поместить в META-INF папку получающегося jar-файла. В этом файле нам надо указать наш AutoConfiguration-класс.
4. Подключить получившийся jar-файл к Spring Boot проекту и задать в конфигурации пути на класс, который создали до этого.

https://www.youtube.com/watch?v=nGfeSo52_8A&t=1735s (с 30мин)



## Источники
- [Spring Boot Interview Questions](#https://www.baeldung.com/spring-boot-interview-questions)